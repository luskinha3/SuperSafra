<!DOCTYPE html>
<html lang="pt-BR" ng-app="SuperSafra">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

	<style>
		.jumbotron{
			width: 600px;
			text-align: center;
			margin-top: 20px;
			margin-right: auto;
			margin-left: auto;
		}
		.table {
			margin-top: 20px;
		}
		.form-control{
			margin-bottom: 5px;
		}
		.selecionado {
			background-color: yellow;
		}
		.negrito{
			font-weight: bold;
		}
	</style>

	<title>Super Safra</title>

	<script src="lib/angular/angular.js"></script>
	<script src="lib/angular/angular-messages.js"></script>
	<script src="lib/angular/angular-locale_pt-br.js"></script>

	<script>
		angular.module("SuperSafra",["ngMessages"]);
		angular.module("SuperSafra").controller("SuperSafraCtrl", function($scope, $filter, $http){
			$scope.appName = "SuperSafra";
			$scope.contatos = [
				{nome: $filter('uppercase')("Pedro"), telefone:"89789789", data: new Date(), operadora: {nome:"Oi", codigo:14, categoria:"Celular"}},
				{nome:"joca", telefone:"82137213", data: new Date(), operadora: {nome:"Vivo", codigo:15, categoria:"Celular"}},
				{nome:"jica", telefone:"81233189", data: new Date(), operadora: {nome:"Tim", codigo:41, categoria:"Celular"}}
			];

			

			var marvet = function() {
				$http({
					method:'GET',
					url: 'https://gateway.marvel.com:443/v1/public/characters?nameStartsWith=a&limit=2&ts=1656745406&apikey=6cbe591a2539d8c5da2db978f1804f08&hash=b4dda23b272b41a833a43ba546dc8963',
				}).then(function sucessCallback(response) {
					console.log(response.data);
				}).catch(function errorCallback(response) {
					console.log('Error: ', response)
				});
			};
			


			$scope.operadoras = [
				{nome:"oi", codigo:"14", preco: 2},
				{nome:"tim", codigo:"16", preco: 3},
				{nome:"vivo", codigo:"41", preco: 1}
			];
			$scope.adicionarContato = function (contato) {
				$scope.contatos.push(angular.copy(contato));
				delete $scope.contato;
				$scope.contatoForm.$setPristine();
			};
			$scope.apagarContatos = function (contatos){
				$scope.contatos = contatos.filter( function(contato){
					if(!contato.selecionado) return contato;
				})
			};
			$scope.isContatoSelecionado = function (contatos){
				return contatos.some(function(contato) {
					return contato.selecionado;
				})
			}
			$scope.ordenaPor = function (campoOrdenacao){
				$scope.criterioDeOrdenacao = campoOrdenacao;
				$scope.direcaoDaOrdenacao = !$scope.direcaoDaOrdenacao;

			};	

			marvet();

		});
			
			

	</script>


</head>
<body ng-controller="SuperSafraCtrl">

	<div class="jumbotron">

		<h3>{{appName}}</h3>
		<input class="form-control"  ng-model="criterioDeBusca" type="text" placeholder="o que você está buscando ?" >
		<table class="table table=striped" ng-hide="contatos.length == 0">

			<tr>
				<th></th>
				<th><a href="" ng-click="ordenaPor('nome')">Nome</a></th>
				<th><a href="" ng-click="ordenaPor('telefone')">Telefone</a></th>
				<th>Operadora</th>
				<th>Data</th>
			</tr>


			<tr ng-class="{selecionado: contato.selecionado}" ng-repeat="contato in contatos | limitTo:2 | filter:{nome: criterioDeBusca} | orderBy:criterioDeOrdenacao:direcaoDaOrdenacao ">
				<td><input type="checkbox" ng-model="contato.selecionado"></td>
				<td>{{contato.nome }}</td>
				<td>{{contato.telefone}}</td>
				<td>{{contato.operadora.nome | lowercase}}</td>
				<td>{{contato.data | date: ' MMM EEE dd/mm/yyyy HH:mm'}}</td>
			</tr>

		</table>

		<br/>
		<form name ="contatoForm">
			<input class="form-control" type="text" ng-model="contato.nome" ng-required="true" ng-minLength="10" placeholder="nome" name="nome">
			<input class="form-control" type="text" ng-model="contato.telefone" ng-required="true"  ng-pattern="/^\d{5}-\d{4}$/" placeholder="telefone" name="telefone">

			<select class="form-control" ng-model="contato.operadora" ng-options="operadora.nome + ' (' + (operadora.preco | currency) + ')' for operadora in operadoras">
				<option value=""> Seleciona uma operadora</option>
			</select>
		</form>

		<div ng-messages="contatoForm.nome.$error" class="alert alert-danger">
			<div ng-message="required ">
				<p>Por favor, preencha o nome </p>
			</div>
			<div ng-message="minlength ">
				<p>o seu nome deve ter pelo menos 10 caracteres </p>
			</div>
		</div>
		

		<div ng-show="contatoForm.telefone.$error.required && contatoForm.$dirty"class="alert alert-danger">
			<p>Por favor, preencha o telefone </p>
		</div>

		<div ng-show="contatoForm.telefone.$error.pattern && contatoForm.$dirty"class="alert alert-danger">
			<p>O telefone deve ter o seguinte formato DDDDD-DDDD </p>
		</div>

		<button class="btn btn-primary btn-block" ng-click="adicionarContato(contato)" ng-disabled="!contato.nome || !contato.telefone"> Enviar</button>
		<button class="btn btn-danger btn-block" ng-click="apagarContatos(contatos)" ng-if="isContatoSelecionado(contatos)"> Apagar contatos</button>
		{{100.24 | number:1}}
	</div>

</body>

</html>